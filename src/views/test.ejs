<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>title</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
    .chartBox {
        width: 640px !important;
        height: 500px !important;
        display: inline-block;
        vertical-align: top;
    }

    .chartContainer {
        white-space: nowrap;
    }

    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap');

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
    }

    .sidebar {
        position: fixed;
        height: 100%;
        width: 200px;
        background: #232322;
        transition: all 0.5s ease;
    }

    .sidebar.active {
        width: 60px;
    }

    .sidebar .logo-details {
        height: 80px;
        display: flex;
        align-items: center;
    }

    .sidebar .logo-details i {
        font-size: 28px;
        font-weight: 500;
        color: #fff;
        min-width: 60px;
        text-align: center
    }

    .sidebar .logo-details .logo_name {
        color: #fff;
        font-size: 24px;
        font-weight: 500;
    }

    .sidebar .nav-links {
        margin-top: 10px;
    }

    .sidebar .nav-links li {
        position: relative;
        list-style: none;
        height: 50px;
    }

    .sidebar .nav-links li a {
        height: 100%;
        width: 100%;
        display: flex;
        align-items: center;
        text-decoration: none;
        transition: all 0.4s ease;
    }

    .sidebar .nav-links li i {
        min-width: 60px;
        text-align: center;
        font-size: 18px;
        color: #fff;
    }

    .sidebar .nav-links li a .links_name {
        color: #fff;
        font-size: 15px;
        font-weight: 400;
        white-space: nowrap;
    }

    .sidebar .nav-links .log_out {
        position: absolute;
        bottom: 0;
        width: 100%;
    }

    .home-section {
        position: relative;
        background: #ffffff;
        min-height: 100vh;
        width: calc(100% - 240px);
        left: 240px;
        transition: all 0.5s ease;
    }

    .sidebar.active~.home-section {
        width: calc(100% - 60px);
        left: 60px;
    }

    .home-section nav {
        display: flex;
        justify-content: space-between;
        height: 80px;
        background: #fff;
        display: flex;
        align-items: center;
        position: fixed;
        width: calc(100% - 240px);
        left: 240px;
        z-index: 100;
        padding: 0 20px;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
        transition: all 0.5s ease;
    }

    .sidebar.active~.home-section nav {
        left: 60px;
        width: calc(100% - 60px);
    }

    .home-section nav .sidebar-button {
        display: flex;
        align-items: center;
        font-size: 24px;
        font-weight: 500;
    }

    nav .sidebar-button i {
        font-size: 35px;
        margin-right: 10px;
    }

    .home-section nav .profile-details {
        display: flex;
        align-items: center;
        background: #F5F6FA;
        border: 2px solid #EFEEF1;
        border-radius: 6px;
        height: 50px;
        min-width: 190px;
        padding: 0 15px 0 2px;
    }

    nav .profile-details img {
        height: 40px;
        width: 40px;
        border-radius: 6px;
        object-fit: cover;
    }

    nav .profile-details .admin_name {
        font-size: 15px;
        font-weight: 500;
        color: #333;
        margin: 0 10px;
        white-space: nowrap;
    }

    nav .profile-details i {
        font-size: 25px;
        color: #333;
    }

    .home-section .home-content {
        position: relative;
        padding-top: 104px;
    }

    /* Responsive Media Query */
    @media (max-width: 1240px) {
        .sidebar {
            width: 60px;
        }

        .sidebar.active {
            width: 220px;
        }

        .home-section {
            width: calc(100% - 60px);
            left: 60px;
        }

        .sidebar.active~.home-section {
            /* width: calc(100% - 220px); */
            overflow: hidden;
            left: 220px;
        }

        .home-section nav {
            width: calc(100% - 60px);
            left: 60px;
        }

        .sidebar.active~.home-section nav {
            width: calc(100% - 220px);
            left: 220px;
        }
    }

    @media (max-width: 1150px) {
        .home-content .sales-boxes {
            flex-direction: column;
        }

        .home-content .sales-boxes .box {
            width: 100%;
            overflow-x: scroll;
            margin-bottom: 30px;
        }

        .home-content .sales-boxes .top-sales {
            margin: 0;
        }
    }

    @media (max-width: 1000px) {
        .overview-boxes .box {
            width: calc(100% / 2 - 15px);
            margin-bottom: 15px;
        }
    }

    @media (max-width: 700px) {

        nav .sidebar-button .dashboard,
        nav .profile-details .admin_name,
        nav .profile-details i {
            display: none;
        }

        .home-section nav .profile-details {
            height: 50px;
            min-width: 40px;
        }

        .home-content .sales-boxes .sales-details {
            width: 560px;
        }
    }

    @media (max-width: 400px) {
        .sidebar {
            width: 0;
        }

        .sidebar.active {
            width: 60px;
        }

        .home-section {
            width: 100%;
            left: 0;
        }

        .sidebar.active~.home-section {
            left: 60px;
            width: calc(100% - 60px);
        }

        .home-section nav {
            width: 100%;
            left: 0;
        }

        .sidebar.active~.home-section nav {
            left: 60px;
            width: calc(100% - 60px);
        }
    }
</style>

<body>
    <div class="sidebar">
        <div class="logo-details">
            <i class='bx bxl-c-plus-plus'></i>
            <span class="logo_name">PCI</span>
        </div>
        <ul class="nav-links">
            <li>
                <a href="#">
                    <i class='bx bx-pie-chart-alt-2'></i>
                    <span class="links_name">Graficas</span>
                </a>
            </li>
            <li class="log_out">
                <a href="#">
                    <i class='bx bx-log-out'></i>
                    <span class="links_name">Log out</span>
                </a>
            </li>
        </ul>
    </div>
    <section class="home-section">
        <nav>
            <div class="sidebar-button">
                <i class='bx bx-menu sidebarBtn'></i>
                <span class="dashboard">Dashboard</span>
            </div>

            <div class="profile-details">
                <span class="admin_name">Usuario</span>
                <i class='bx bx-chevron-down'></i>
            </div>
        </nav>

        <div class="home-content">
            <div class="chartContainer">
                <div class="chartBox">
                    <canvas id="graphVoltage"></canvas>
                </div>
                <div class="chartBox">
                    <canvas id="graphCurrent"></canvas>
                </div>
            </div>
        </div>
    </section>


    <script>

        const socket = io();
        let chartC;
        let chartV;
        socket.on('data', (data) => {
            const arrayTime = data.arrayTime;
            const arrayVoltage = data.arrayVoltage;
            const arrayCurrent = data.arrayCurrent;
            const arrayTimeC = data.arrayTimeC;

            //setup
            if (!chartC & !chartV) {
                const datachartVoltage = {
                    labels: arrayTime,
                    font: {
                        size: 14,
                        color: '#000000'
                    },
                    datasets: [{
                        label: 'Voltage',
                        data: arrayVoltage,
                        backgroundColor: '#000000',
                        borderColor: '#000000',
                        borderWidth: 3,
                        pointStyle: false

                    }]
                }

                const datachartCurrent = {
                    labels: arrayTimeC,
                    font: {
                        size: 14,
                        color: '#000000'
                    },
                    datasets: [{
                        label: 'Current',
                        data: arrayCurrent,
                        backgroundColor: '#000000',
                        borderColor: '#000000',
                        borderWidth: 3,
                        pointStyle: false

                    }]
                }
                //plugin
                const plugin = {
                    id: 'customCanvasBackgroundColor',
                    beforeDraw: (chart, args, options) => {
                        const { ctx } = chart;
                        ctx.save();
                        ctx.globalCompositeOperation = 'destination-over';
                        ctx.fillStyle = options.color || '#99ffff';
                        ctx.fillRect(0, 0, chart.width, chart.height);
                        ctx.restore();
                    }
                };



                //config

                const configVoltage = {
                    type: 'line',
                    data: datachartVoltage,
                    options: {
                        animation: {
                            duration: 0
                        },
                        plugins: {
                            customCanvasBackgroundColor: {
                                color: '#F1F1F1',
                            },
                            title: {
                                display: true,
                                text: 'Grafica en tiempo real voltaje',
                                color: '#000000'
                            },
                            legend: {
                                labels: {
                                    font: {
                                        size: 20,
                                        color: "#000000"
                                    }
                                }
                            },
                            scales: {
                                xAxes: [{
                                    ticks: {
                                        fontColor: 'white'
                                    }
                                }],
                                yAxes: [{
                                    ticks: {
                                        fontColor: 'white'
                                    }
                                }]
                            }, responsive: false,
                        }
                    },
                    plugins: [plugin],
                };

                const configCurrent = {
                    type: 'line',
                    data: datachartCurrent,
                    options: {
                        animation: {
                            duration: 0
                        },
                        plugins: {
                            customCanvasBackgroundColor: {
                                color: '#F1F1F1',
                            },
                            title: {
                                display: true,
                                text: 'Grafica en tiempo real corriente',
                                color: '#000000'
                            },
                            legend: {
                                labels: {
                                    font: {
                                        size: 20,
                                        color: "000000"
                                    }
                                }
                            },
                            scales: {
                                xAxes: [{
                                    ticks: {
                                        fontColor: 'white'
                                    }
                                }],
                                yAxes: [{
                                    ticks: {
                                        fontColor: 'white'
                                    }
                                }]
                            }, responsive: false,
                        }
                    }, plugins: [plugin],
                };

                async function initchart() {



                    //render
                    const ctx = document.getElementById('graphVoltage');
                    chartV = new Chart(ctx,
                        configVoltage);

                    const cc = document.getElementById('graphCurrent');
                    chartC = new Chart(cc, configCurrent);


                }

                initchart();
            } else {

                chartV.data.labels.push(arrayTime.slice(-1)[0]);
                chartV.data.labels.shift();
                chartV.data.datasets.forEach((dataset) => {
                    dataset.data.push(arrayVoltage.slice(-1)[0]);
                    dataset.data.shift();
                });
                chartV.update();
                chartC.data.labels.push(arrayTime.slice(-1)[0]);
                chartC.data.labels.shift();
                chartC.data.datasets.forEach((dataset) => {
                    dataset.data.push(arrayCurrent.slice(-1)[0]);
                    dataset.data.shift();
                });
                chartC.update();
            }


        });
    </script>
</body>

</html>